<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Produto</title>
</head>
<body>
    <header>
        <h1>Cadastro de Produto</h1>
        <h2></h2>
    </header>
    <main>
        <form method="post" btnCadastro successRedirect="index.html">
            Codigo: <input id="pCode" type="text" name="codigo"/><br/>
            Nome:<input id="pNome" type="text" name="nome"/><br/>
            Descrição: <input id="pDescricao" type="text" name="descricao"/><br/>
            ID do Lote: <select id="lotes" name="passs" class="tipoSelect"><br/> 
            </select><br>  
            
        </form>

        <button type="submit" id="btnCadastro">Cadastrar</button>
    </main>
    <script>
        function rq1(){
            fetch(`http://localhost:8080/Lote`,{
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                let allLotes = data;
                console.log(allLotes)
                let html = '';
                for (var i = 0; i < allLotes.length; i++){
                    html += "<option id='loteSelect' value=" + allLotes[i].id + ">" + allLotes[i].observacao + "</option>"
                }

                document.getElementById('lotes').innerHTML = html;

            })
            }
           rq1();


const pCod = document.getElementById('pCode').value
const loteSelect = document.getElementById('lotes').value;
const pNome = document.getElementById('pNome').value;
const pDescricao = document.getElementById('pDescricao').value;

alert(loteSelect + pNome + pDescricao)
const pCodigo = parseInt(pCod)
const parserLoteId = parseInt(loteSelect)

document.getElementById("btnCadastro").addEventListener("click",
    function(target){
        target.preventDefault();
        const json = {}
        const dataForm = new FormData(document.forms[0])

        for(let [name, value] of dataForm){
            if(name !== "passs"){
                json[name] = value
            }
        }
        alert('passou')
        fetch("http://localhost:8080/Produto",{
            method: "POST",
            body: JSON.stringify
            ({
                codigo: pCodigo,
                id_lote: parserLoteId,
                nome: pNome,
                descricao: pDescricao

            }),
            headers: {
                'Content-Type': 'application/json'
            }

        }).then(function(response){return response.text()})
        .then(function(data){
            alert(data)
        }).catch(function(erro){
            alert(erro)
        })
        alert('passou')
    }
)
    </script>
    <script></script>
</body>
</html>