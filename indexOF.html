<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    <link href="user/style/layoutReadAll.css">
    <title>Lista de Fiscalizador</title>


    
    <style>
        body{
            background-color: rgb(255, 255, 255);
            color: rgb(0, 0, 0);
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            
        }

        .posts-list{
            width: 300px;
            text-align: center;
            margin: auto;
           
        
        }

        .title{
            text-align: center;
        }

        .card-title:hover{
            color: rgb(9, 125, 179);
        }

    </style>
</head>
<body>

    <div id="mainDiv"></div>
    <div class="title">
    <h1>Lista de Fiscalizadores: </h1>
  
    <main>
        BUSCAR ORGÃO FISCALIZADOR <input type="text" id="input-fiscalizador"/>
        <button name="btn-busca-fiscalizador" id="btn-busca-fiscalizador"  class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">Buscar FIscalizador</button>        <a href="index.html"><button id="btnVoltar" class="btn btn-primary">VOLTAR</button></a>    
        <br/>
        <div id="divMain"></div>
    </main>
    </div>
    <ul>
        <form method="put" action="indexOF.html">

        </form>
    </ul>
   
    <script>
        const listEl = document.querySelector('ul');
        fetch(`http://localhost:8080/OrgaoFiscalizador`)
        .then((response) => response.json())
        .then((data) => data.forEach(of => {
            listEl.insertAdjacentHTML('beforeend', `<br>`)
            listEl.insertAdjacentHTML('beforeend', `<div id="itens" class="posts-list row" >
            <div class="card mt-4 col-md-6 bg-ligt" style="width: 18rem;">
                <div  class="card-body">
                  <h5 class="card-title"> ${of.id} - ${of.nome}</h5>
                  <h6 class="card-subtitle mb-2 text-muted"></h6>
                  <p class="card-text">${of.descricao}</p>
                  <button id="btn-editar" onclick="editarFiscalizador(${of.id})" class="btn btn-outline-secondary">Editar</button>
                  <button id="btn-deletar" onclick="deletarFiscalizador(${of.id})" class="btn btn-outline-secondary">Deletar</button>
                </div>
              </div>
        </div>`)       
        
        }));


        async function editarFiscalizador(id){
            const formEditar = document.querySelector('form');

            fetch(`http://localhost:8080/OrgaoFiscalizador`)
            .then(response => response.json())
            .then(data => data.forEach(of => {
                if(of.id == id){
                    formEditar.insertAdjacentHTML('beforeend', `<input type="text" id="input-nome-fiscalizador" value="${of.nome}"> `)
                    formEditar.insertAdjacentHTML('beforeend', `<input type="text" id="input-descricao-fiscalizador" value="${of.descricao}"> `)
                    formEditar.insertAdjacentHTML('beforeend', `<button onclick="realizaEdicaoFiscalizador(${of.id})" type="submit">Alterar</button>`)
                }
            }));
        }


        async function realizaEdicaoFiscalizador(id){
            const nomeFiscalizador = document.getElementById('input-nome-fiscalizador').value
            const descricaoFiscalizador = document.getElementById('input-descricao-fiscalizador').value
            const requestOptions = {
                method: 'PUT',
                headers: {'Content-Type' : 'application/json'},
                body:  JSON.stringify
                ({
                    id: id,
                    nome: nomeFiscalizador,
                    descricao: descricaoFiscalizador 
                })
            };

            await fetch('http://localhost:8080/OrgaoFiscalizador', requestOptions)
            .fetch(response => response.json()).then(location.href = location.href)
        }
        


        async function deletarFiscalizador(id){
            await fetch(`http://localhost:8080/OrgaoFiscalizador/${id}`, 
            {method: 'DELETE'}).then(response => response.json()).then(location.href = location.href)
        }
    </script>

<script>

    document.getElementById("btn-busca-fiscalizador").addEventListener("click", async function(){
    const idFiscalizador = document.getElementById("input-fiscalizador").value
    const divMainZ = document.getElementById("divMain")

    fetch(`http://localhost:8080/OrgaoFiscalizador/${idFiscalizador}`, 
    {Method: "GET"})
    .then(response => {return response.json()})
    .then(data => {
        if(data.status == 400){
            divMain.innerHTML = `Órgão Fiscalizador não encontrado!!`
            return
        } else if(data.status == 500){
            divMain.innerHTML = `Problema com a requisição!!`
            return
        }

        let {nome, descricao} = data
        divMainZ.innerHTML = `<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">${nome}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            ${descricao} 
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>`


    }).catch(erro => {alert(erro)})
})

</script>
</body>
</html>